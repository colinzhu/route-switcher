<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, user-scalable=yes">
    <title>Route Switcher</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.7/dist/cdn.min.js"></script>
    <script src="main.js"></script>
    <style>
        .no-underline a {
          text-decoration: none
        }
    </style>
</head>

<body>
<div class="container-fluid" x-data="{}">
    <nav>
        <ul>
            <li>
                <h1>Route Switcher</h1>
            </li>
        </ul>
        <ul>
            <li><button role="button" @click="$dispatch('addrecord')">Add Rule</button></li>
        </ul>
    </nav>
</div>

<!-- list of records -->
<div class="overflow-auto" x-data="recordListData" x-init="loadRecords" @recordupdated.document="loadRecords">
    <table class="striped">
        <thead>
        <tr>
            <th scope="col">uriPrefix</th>
            <th scope="col">target</th>
            <th scope="col">user</th>
            <th scope="col">updateTime</th>
            <th scope="col">remark</th>
            <th scope="col">action</th>
        </tr>
        </thead>
        <tbody>
        <template x-for="item in records">
            <tr>
                <td x-text="item.uriPrefix"></td>
                <td x-html="'<mark>' + item.target + '</mark>' + item.uriPrefix"></td>
                <td x-text="item.user"></td>
                <td x-html="new Date(item.updateTime).toLocaleString()"></td>
                <td x-text="item.remark"></td>
                <td class="no-underline">
                    <a href="#" @click.prevent="$dispatch('updaterecord', { uriPrefix: item.uriPrefix, target: item.target, remark: item.remark})">üìù</a>
                    <a href="#" @click.prevent="deleteRecord(item.uriPrefix, item.target)">‚ùé</a>
                </td>
            </tr>
        </template>
        </tbody>
    </table>
</div>


<!-- edit form -->
<dialog x-data="recordFormData" x-bind:open="isEditing" @addrecord.document="showCreateForm"
        @updaterecord.document="loadItemToUpdate($event.detail)">
    <article x-transition>
        <header>
            <h3>Add / Update</h3>
        </header>
        <form method="post" @submit.prevent="submit" id="recordEditForm">
            <label>uriPrefix (e.g. /api/v1)
                <input type="text" x-model="uriPrefix" required x-bind:disabled="isSubmitting || editMode == 'update'" pattern="^/.*$"/>
            </label>
            <label>target (Host and port only. e.g. http://example.com:1234)
                <input type="text" x-model="target" x-bind:disabled="isSubmitting" required pattern="https?:\/\/[\w.\-]+(:\d{1,5})?$" />
            </label>
            <label>remark
                <input type="text" x-model="remark" x-bind:disabled="isSubmitting" />
            </label>
            <button x-bind:disabled="isSubmitting" x-bind:aria-busy="isSubmitting">Submit</button>
            <button x-bind:disabled="isSubmitting" @click="cancel" type="reset">Cancel</button>
        </form>
    </article>
</dialog>

<div style="padding:1rem;font-size:0.8rem"><pre id="messages" style="white-space:pre-wrap"></pre></div>
</body>

</html>